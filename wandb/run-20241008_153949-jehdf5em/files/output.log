2024-10-08 15:39:51,310 - WARNING - Disabling compilation
2024-10-08 15:39:52,286 - INFO - used cuda memory after creating model: 552298496
Number of decayed parameter tensors 50 for a total of 124354560 parameters
Number of non-decayed parameter tensors 98 for a total of 121344 parameters
2024-10-08 15:39:52,872 - INFO - total desired batch size: 524288
2024-10-08 15:39:52,872 - INFO - => computed gradient accumulation steps 32
2024-10-08 15:39:58,018 - INFO - tokens per second = 101953 | loss: 10.644546 | gradient norm 0.1729 | dt 5142.452002 ms | CUDA memory: 1022.55 MB | CPU memory: 2.00 GB
2024-10-08 15:40:03,246 - INFO - tokens per second = 100308 | loss: 10.620717 | gradient norm 0.1649 | dt 5226.804256 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:40:08,309 - INFO - tokens per second = 103560 | loss: 10.590879 | gradient norm 0.1884 | dt 5062.673330 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:40:13,265 - INFO - tokens per second = 105788 | loss: 10.537363 | gradient norm 0.1979 | dt 4956.004858 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:40:18,006 - INFO - tokens per second = 110570 | loss: 10.467772 | gradient norm 0.1764 | dt 4741.695881 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:40:22,729 - INFO - tokens per second = 111011 | loss: 10.385662 | gradient norm 0.1594 | dt 4722.848654 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:40:27,453 - INFO - tokens per second = 110989 | loss: 10.309171 | gradient norm 0.1493 | dt 4723.779678 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:40:32,176 - INFO - tokens per second = 110998 | loss: 10.216917 | gradient norm 0.1312 | dt 4723.409891 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:40:36,903 - INFO - tokens per second = 110913 | loss: 10.135113 | gradient norm 0.1394 | dt 4727.038622 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:40:41,626 - INFO - tokens per second = 111010 | loss: 10.057099 | gradient norm 0.1233 | dt 4722.902536 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:40:46,352 - INFO - tokens per second = 110947 | loss: 9.981432 | gradient norm 0.1095 | dt 4725.570917 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:40:51,196 - INFO - tokens per second = 108251 | loss: 9.928338 | gradient norm 0.1098 | dt 4843.253851 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:40:56,118 - INFO - tokens per second = 106503 | loss: 9.858924 | gradient norm 0.0981 | dt 4922.730684 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:41:01,078 - INFO - tokens per second = 105712 | loss: 9.813996 | gradient norm 0.0929 | dt 4959.605217 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:41:06,032 - INFO - tokens per second = 105820 | loss: 9.755445 | gradient norm 0.0943 | dt 4954.542637 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:41:10,948 - INFO - tokens per second = 106641 | loss: 9.699927 | gradient norm 0.0837 | dt 4916.384459 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:41:15,675 - INFO - tokens per second = 110911 | loss: 9.653884 | gradient norm 0.0869 | dt 4727.108479 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:41:20,568 - INFO - tokens per second = 107153 | loss: 9.609907 | gradient norm 0.0861 | dt 4892.910004 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:41:25,375 - INFO - tokens per second = 109088 | loss: 9.570951 | gradient norm 0.0869 | dt 4806.096315 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:41:30,226 - INFO - tokens per second = 108062 | loss: 9.583989 | gradient norm 0.0768 | dt 4851.742506 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:41:35,119 - INFO - tokens per second = 107150 | loss: 9.572758 | gradient norm 0.0726 | dt 4893.036127 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:41:39,897 - INFO - tokens per second = 109734 | loss: 9.457896 | gradient norm 0.0736 | dt 4777.805328 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:41:44,671 - INFO - tokens per second = 109814 | loss: 9.422308 | gradient norm 0.0725 | dt 4774.315357 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:41:49,482 - INFO - tokens per second = 108976 | loss: 9.389619 | gradient norm 0.0720 | dt 4811.048985 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:41:54,408 - INFO - tokens per second = 106443 | loss: 9.386435 | gradient norm 0.0737 | dt 4925.517082 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:41:59,175 - INFO - tokens per second = 109970 | loss: 9.334542 | gradient norm 0.0730 | dt 4767.533541 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:42:03,902 - INFO - tokens per second = 110911 | loss: 9.326037 | gradient norm 0.0720 | dt 4727.115154 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:42:08,713 - INFO - tokens per second = 108977 | loss: 9.297728 | gradient norm 0.0671 | dt 4811.000824 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:42:13,660 - INFO - tokens per second = 105999 | loss: 9.252441 | gradient norm 0.0765 | dt 4946.177721 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:42:18,606 - INFO - tokens per second = 105995 | loss: 9.253005 | gradient norm 0.0702 | dt 4946.338654 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:42:23,386 - INFO - tokens per second = 109702 | loss: 9.217114 | gradient norm 0.0652 | dt 4779.204607 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:42:28,339 - INFO - tokens per second = 105823 | loss: 9.243655 | gradient norm 0.0694 | dt 4954.371214 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:42:33,145 - INFO - tokens per second = 109095 | loss: 9.189763 | gradient norm 0.0680 | dt 4805.788517 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:42:37,914 - INFO - tokens per second = 109942 | loss: 9.188680 | gradient norm 0.0747 | dt 4768.762112 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:42:42,687 - INFO - tokens per second = 109857 | loss: 9.157498 | gradient norm 0.0664 | dt 4772.459030 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:42:47,579 - INFO - tokens per second = 107165 | loss: 9.082188 | gradient norm 0.0681 | dt 4892.361879 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:42:52,420 - INFO - tokens per second = 108300 | loss: 9.110353 | gradient norm 0.0661 | dt 4841.069460 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:42:57,235 - INFO - tokens per second = 108884 | loss: 9.102632 | gradient norm 0.0698 | dt 4815.104723 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:43:02,134 - INFO - tokens per second = 107016 | loss: 9.065017 | gradient norm 0.0699 | dt 4899.153471 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:43:06,935 - INFO - tokens per second = 109214 | loss: 9.018354 | gradient norm 0.0697 | dt 4800.543547 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:43:11,844 - INFO - tokens per second = 106807 | loss: 9.038409 | gradient norm 0.0696 | dt 4908.741713 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:43:16,635 - INFO - tokens per second = 109431 | loss: 9.013183 | gradient norm 0.0656 | dt 4791.039944 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:43:21,530 - INFO - tokens per second = 107088 | loss: 8.971338 | gradient norm 0.0773 | dt 4895.850658 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:43:26,353 - INFO - tokens per second = 108724 | loss: 8.919012 | gradient norm 0.0674 | dt 4822.182417 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:43:31,289 - INFO - tokens per second = 106216 | loss: 8.917949 | gradient norm 0.0629 | dt 4936.072350 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:43:36,145 - INFO - tokens per second = 107956 | loss: 8.931123 | gradient norm 0.0607 | dt 4856.487274 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:43:41,002 - INFO - tokens per second = 107941 | loss: 8.902890 | gradient norm 0.0605 | dt 4857.190132 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:43:45,844 - INFO - tokens per second = 108298 | loss: 8.845992 | gradient norm 0.0694 | dt 4841.178656 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:43:50,740 - INFO - tokens per second = 107084 | loss: 8.848432 | gradient norm 0.0603 | dt 4896.027565 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:43:55,733 - INFO - tokens per second = 105021 | loss: 8.803783 | gradient norm 0.0616 | dt 4992.222309 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:44:00,633 - INFO - tokens per second = 106967 | loss: 8.762260 | gradient norm 0.0634 | dt 4901.411533 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:44:05,778 - INFO - tokens per second = 101925 | loss: 8.746408 | gradient norm 0.0608 | dt 5143.837929 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:44:10,850 - INFO - tokens per second = 103364 | loss: 8.733858 | gradient norm 0.0568 | dt 5072.245598 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:44:16,026 - INFO - tokens per second = 101268 | loss: 8.687970 | gradient norm 0.0572 | dt 5177.218437 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:44:20,991 - INFO - tokens per second = 105610 | loss: 8.674942 | gradient norm 0.0592 | dt 4964.384556 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:44:26,041 - INFO - tokens per second = 103812 | loss: 8.619006 | gradient norm 0.0613 | dt 5050.364494 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:44:31,011 - INFO - tokens per second = 105495 | loss: 8.640865 | gradient norm 0.0579 | dt 4969.805002 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:44:35,891 - INFO - tokens per second = 107426 | loss: 8.587448 | gradient norm 0.0617 | dt 4880.446911 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:44:40,820 - INFO - tokens per second = 106383 | loss: 8.571413 | gradient norm 0.0553 | dt 4928.323746 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:44:45,833 - INFO - tokens per second = 104603 | loss: 8.553891 | gradient norm 0.0568 | dt 5012.149096 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:44:50,651 - INFO - tokens per second = 108789 | loss: 8.510036 | gradient norm 0.0574 | dt 4819.318295 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:44:55,507 - INFO - tokens per second = 107975 | loss: 8.484588 | gradient norm 0.0558 | dt 4855.641127 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:45:00,256 - INFO - tokens per second = 110387 | loss: 8.463413 | gradient norm 0.0556 | dt 4749.548912 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:45:05,117 - INFO - tokens per second = 107889 | loss: 8.443372 | gradient norm 0.0563 | dt 4859.534502 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:45:10,020 - INFO - tokens per second = 106919 | loss: 8.377573 | gradient norm 0.0538 | dt 4903.598547 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
2024-10-08 15:45:14,869 - INFO - tokens per second = 108115 | loss: 8.347215 | gradient norm 0.0535 | dt 4849.375486 ms | CUDA memory: 1973.05 MB | CPU memory: 2.08 GB
Traceback (most recent call last):
  File "/home/enzo/Documents/gpt2/gpt2_fabric.py", line 294, in <module>
    loss, norm = training_step(x, y)
                 ^^^^^^^^^^^^^^^^^^^
  File "/home/enzo/Documents/gpt2/gpt2_fabric.py", line 265, in training_step
    norm = torch.nn.utils.clip_grad_norm_(model.parameters(),
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/enzo/mambaforge/envs/up_to_date/lib/python3.12/site-packages/torch/nn/utils/clip_grad.py", line 21, in _no_grad_wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/enzo/mambaforge/envs/up_to_date/lib/python3.12/site-packages/torch/nn/utils/clip_grad.py", line 82, in clip_grad_norm_
    clip_coef = max_norm / (total_norm + 1e-6)
                ~~~~~~~~~^~~~~~~~~~~~~~~~~~~~~
  File "/home/enzo/mambaforge/envs/up_to_date/lib/python3.12/site-packages/torch/_tensor.py", line 35, in wrapped
    @functools.wraps(f, assigned=assigned)

KeyboardInterrupt
